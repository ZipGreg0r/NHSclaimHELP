function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);
    
    // Otwórz arkusz
    const sheet = SpreadsheetApp.getActiveSheet();
    
    // Dodaj nagłówki (jeśli to pierwszy wiersz)
    if (sheet.getLastRow() === 0) {
      sheet.appendRow(['Imię', 'Nazwisko', 'Email', 'Telefon', 'Typ sprawy', 'Opis', 'Czas oczekiwania', 'Pliki', 'Data']);
    }
    
    // Dodaj nowy wiersz z danymi
    sheet.appendRow([
      data.firstName,
      data.lastName,
      data.email,
      data.phone,
      data.caseType,
      data.description,
      data.waitingTime,
      data.fileNames.join(', '),
      new Date()
    ]);
    
    // Wyślij email do Ciebie
    MailApp.sendEmail('zipgreg0r@gmail.com', 'Nowe zgłoszenie - NHS Claim Help', 
      `Imię: ${data.firstName}\nNazwisko: ${data.lastName}\nEmail: ${data.email}\nTelefon: ${data.phone}\nTyp sprawy: ${data.caseType}\nOpis: ${data.description}`
    );
    
    // Wyślij potwierdzenie do użytkownika
    MailApp.sendEmail(data.email, 'NHS Claim Help - Potwierdzenie zgłoszenia',
      `Dziękujemy za kontakt!\n\nTwoje dane zostały otrzymane.\nSpecjalista skontaktuje się z Tobą wkrótce.\n\nZ poważaniem,\nNHS Claim Help Team`
    );
    
    return ContentService.createTextOutput(JSON.stringify({success: true})).setMimeType(ContentService.MimeType.JSON);
  } catch(error) {
    return ContentService.createTextOutput(JSON.stringify({success: false, error: error.toString()})).setMimeType(ContentService.MimeType.JSON);
  }
}
